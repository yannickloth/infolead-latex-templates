% ============================================================================
% KOMA-SCRIPT CONFIGURATION
% ============================================================================
% Settings specific to the KOMA-Script document class (scrreprt, scrbook, or scrartcl).
% Requires: KOMA-Script document class

% Verify KOMA-Script document class is loaded
\makeatletter
\@ifundefined{KOMAClassName}{%
  \PackageError{koma-config}{KOMA-Script document class required}{%
    This file requires a KOMA-Script document class (scrreprt, scrbook, or scrartcl).%
  }%
}{}
\makeatother

% KOMA-Script compatibility fixes for older packages
\usepackage{scrhack}

% KOMA-Script document options
\KOMAoptions{
  toc=bibliography,
  toc=listof,
  headings=normal,
  parskip=half,
  headheight=27.2pt
}

% Configure abstract environment to show heading and prevent page breaks
\makeatletter
\providecommand*{\abstractname}{Abstract}
% Check if abstract environment exists by checking for \abstract command
\@ifundefined{abstract}{%
  % Define new abstract environment if it doesn't exist (scrbook case)
  \newenvironment{abstract}{%
    \@ifundefined{chapter}{%
      \section*{\abstractname}%
    }{%
      \chapter*{\abstractname}%
      \addcontentsline{toc}{chapter}{\abstractname}%
    }%
    \quotation
  }{%
    \endquotation
    \@ifundefined{chapter}{}{\clearpage}%
  }%
}{%
  % Redefine existing abstract environment (scrreprt/scrartcl case)
  \renewenvironment{abstract}{%
    \@ifundefined{chapter}{%
      \section*{\abstractname}%
    }{%
      \chapter*{\abstractname}%
      \addcontentsline{toc}{chapter}{\abstractname}%
    }%
    \quotation
  }{%
    \endquotation
    \@ifundefined{chapter}{}{\clearpage}%
  }%
}
\makeatother

% Increase TOC number width for section entries to prevent overflow
\RedeclareSectionCommand[
  tocnumwidth=4em
]{section}

\RedeclareSectionCommand[
  tocnumwidth=4em
]{subsection}

\RedeclareSectionCommand[
  tocnumwidth=4em
]{subsubsection}
