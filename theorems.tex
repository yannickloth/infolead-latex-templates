% ============================================================================
% UNIFIED THEOREM-LIKE ENVIRONMENTS
% ============================================================================
% Comprehensive definitions for all theorem-like structures used in academic
% and scientific documents. Combines standard mathematical theorems,
% IVP-specific environments, and scientific claim environments with enhanced
% visual styling.
%
% Requires: amsthm, tcolorbox, xcolor packages
%
% This file supersedes:
%   - theorems-standard.tex (generic math theorems)
%   - theorems-ivp.tex (IVP-specific theorems)
%   - theorems-scientific.tex (scientific claims with tcolorbox styling)
%
% All styling is black-and-white print friendly (uses patterns/borders, not colors)

% Verify required packages are loaded
\makeatletter
\@ifpackageloaded{amsthm}{}{%
  \PackageError{theorems}{amsthm package required}{%
    This file requires the amsthm package to be loaded first.%
  }%
}
\@ifpackageloaded{tcolorbox}{}{%
  \usepackage[most]{tcolorbox}%
}
\makeatother

% Load tcolorbox theorem library for enhanced boxes
\tcbuselibrary{theorems,skins,breakable}

% ============================================================================
% PART 1: STANDARD MATHEMATICAL ENVIRONMENTS
% ============================================================================
% Generic mathematical theorem-like structures commonly used in academic writing.

% Plain style (italic body) for mathematical statements
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}

% Definition style (upright body) for definitions
\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{example}{Example}[chapter]

% Remark style for notes and remarks
% Custom environment with closing marker for multi-paragraph clarity
\theoremstyle{remark}
\newtheorem{remark@inner}{Remark}
\newenvironment{remark}
  {\begin{remark@inner}}
  {\hfill$\diamond$\end{remark@inner}}

% ============================================================================
% PART 2: IVP AND DESIGN THEORY ENVIRONMENTS
% ============================================================================
% Custom theorem-like structures for IVP (Independent Variation Principle)
% and software design theory documents.

\theoremstyle{definition}
\newtheorem{principle}{Principle}
\newtheorem{directive}{Directive}
\newtheorem{problem}{Problem}
\newtheorem{pattern}{Pattern}
\newtheorem{design-decision}{Design Decision}
\newtheorem{fallacy}{Fallacy}
\newtheorem{observation}{Observation}
\newtheorem{instantiation}{Instantiation}
\newtheorem{construction}{Construction}
\newtheorem{speculation}{Speculation}

% ============================================================================
% PART 3: SCIENTIFIC CLAIM ENVIRONMENTS (with tcolorbox styling)
% ============================================================================
% Custom theorem-like structures for scientific manuscripts that need to
% distinguish between different epistemic statuses of claims.
% All styling is black-and-white print friendly.

% ----------------------------------------------------------------------------
% COLOR DEFINITIONS (grayscale-friendly)
% ----------------------------------------------------------------------------
\definecolor{achievementbg}{gray}{0.95}      % Light gray background
\definecolor{achievementframe}{gray}{0.3}    % Dark gray frame
\definecolor{predictionbg}{gray}{0.92}       % Slightly darker gray
\definecolor{predictionframe}{gray}{0.2}     % Very dark frame
\definecolor{warningbg}{gray}{0.97}          % Near white
\definecolor{warningframe}{gray}{0.4}        % Medium gray
\definecolor{openquestionbg}{gray}{0.98}     % Near white
\definecolor{openquestionframe}{gray}{0.5}   % Medium-light gray
\definecolor{requirementbg}{gray}{0.96}      % Light gray
\definecolor{requirementframe}{gray}{0.35}   % Medium-dark gray
\definecolor{hypothesisbg}{gray}{0.97}       % Near white
\definecolor{hypothesisframe}{gray}{0.45}    % Medium gray
\definecolor{axiombg}{gray}{0.93}            % Slightly darker for prominence
\definecolor{axiomframe}{gray}{0.15}         % Very dark frame (foundational)
\definecolor{assumptionbg}{gray}{0.97}       % Near white
\definecolor{assumptionframe}{gray}{0.5}     % Medium gray

% ----------------------------------------------------------------------------
% COUNTER SETUP
% ----------------------------------------------------------------------------
% Shared counter for all scientific claim environments (numbered sequentially)
\newcounter{scientificclaim}[chapter]
\renewcommand{\thescientificclaim}{\thechapter.\arabic{scientificclaim}}

% ----------------------------------------------------------------------------
% PAGE BREAK BEHAVIOR
% ----------------------------------------------------------------------------
% All scientific claim boxes use 'breakable' but with settings that keep them
% together unless they genuinely exceed the available page space. The box will
% be moved to the next page if it doesn't fit, and only break across pages if
% it's longer than a full page.

% ----------------------------------------------------------------------------
% ACHIEVEMENT ENVIRONMENT
% ----------------------------------------------------------------------------
% For novel findings and breakthrough results unique to the theory.
% Styled with double-line border for maximum visibility in B&W.

\newtcolorbox[use counter=scientificclaim, number within=chapter]{achievement}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=achievementbg,
  colframe=achievementframe,
  boxrule=0.8pt,
  arc=2pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Achievement~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={1.5pt}{-3pt}{achievementframe!50},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=achievementbg,
    colframe=achievementframe,
    boxrule=0.5pt,
    arc=1pt
  }
}

% ----------------------------------------------------------------------------
% PREDICTION ENVIRONMENT
% ----------------------------------------------------------------------------
% For testable, falsifiable predictions.
% Styled with dashed border to indicate "future verification needed".

\newtcolorbox[use counter=scientificclaim, number within=chapter]{prediction}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=predictionbg,
  colframe=predictionframe,
  boxrule=1pt,
  arc=0pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Prediction~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={0.8pt}{0pt}{predictionframe, dashed},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=predictionbg,
    colframe=predictionframe,
    boxrule=0.5pt,
    arc=0pt
  }
}

% ----------------------------------------------------------------------------
% WARNING ENVIRONMENT
% ----------------------------------------------------------------------------
% For caveats, limitations, and scope boundaries.
% Styled with left bar for quick visual identification.

\newtcolorbox[use counter=scientificclaim, number within=chapter]{warning}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=warningbg,
  colframe=warningframe,
  boxrule=0pt,
  arc=0pt,
  left=10pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Warning~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline west={3pt}{0pt}{warningframe},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=warningbg,
    colframe=warningframe,
    boxrule=0.5pt,
    arc=0pt
  }
}

% ----------------------------------------------------------------------------
% OPEN QUESTION ENVIRONMENT
% ----------------------------------------------------------------------------
% For unresolved problems and directions for future research.
% Styled with dotted border to indicate "incomplete/open".

\newtcolorbox[use counter=scientificclaim, number within=chapter]{open_question}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=openquestionbg,
  colframe=openquestionframe,
  boxrule=0pt,
  arc=2pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Open Question~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={1pt}{0pt}{openquestionframe, dotted},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=openquestionbg,
    colframe=openquestionframe,
    boxrule=0.5pt,
    arc=1pt
  }
}

% ----------------------------------------------------------------------------
% REQUIREMENT ENVIRONMENT
% ----------------------------------------------------------------------------
% For necessary conditions and consistency requirements.
% Styled with solid border and corner markers for "must have" emphasis.

\newtcolorbox[use counter=scientificclaim, number within=chapter]{requirement}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=requirementbg,
  colframe=requirementframe,
  boxrule=0.6pt,
  arc=0pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Requirement~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  overlay={
    \draw[requirementframe, line width=1.5pt]
      ([xshift=3pt,yshift=-3pt]frame.north west) -- ++(8pt,0)
      ([xshift=3pt,yshift=-3pt]frame.north west) -- ++(0,-8pt);
    \draw[requirementframe, line width=1.5pt]
      ([xshift=-3pt,yshift=-3pt]frame.north east) -- ++(-8pt,0)
      ([xshift=-3pt,yshift=-3pt]frame.north east) -- ++(0,-8pt);
    \draw[requirementframe, line width=1.5pt]
      ([xshift=3pt,yshift=3pt]frame.south west) -- ++(8pt,0)
      ([xshift=3pt,yshift=3pt]frame.south west) -- ++(0,8pt);
    \draw[requirementframe, line width=1.5pt]
      ([xshift=-3pt,yshift=3pt]frame.south east) -- ++(-8pt,0)
      ([xshift=-3pt,yshift=3pt]frame.south east) -- ++(0,8pt);
  },
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=requirementbg,
    colframe=requirementframe,
    boxrule=0.5pt,
    arc=0pt
  }
}

% ----------------------------------------------------------------------------
% POSTDICTION ENVIRONMENT
% ----------------------------------------------------------------------------
% For derived results that match already-known data (epistemic honesty).
% Styled similarly to prediction but with solid border (already verified).

\newtcolorbox[use counter=scientificclaim, number within=chapter]{postdiction}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=predictionbg,
  colframe=predictionframe,
  boxrule=1pt,
  arc=0pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Postdiction~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=predictionbg,
    colframe=predictionframe,
    boxrule=0.5pt,
    arc=0pt
  }
}

% ----------------------------------------------------------------------------
% CONSISTENCY CHECK ENVIRONMENT
% ----------------------------------------------------------------------------
% For verification that the theory reproduces known physics.

\newtcolorbox[use counter=scientificclaim, number within=chapter]{consistency_check}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=achievementbg,
  colframe=achievementframe,
  boxrule=0.5pt,
  arc=2pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Consistency Check~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=achievementbg,
    colframe=achievementframe,
    boxrule=0.5pt,
    arc=1pt
  }
}

% ----------------------------------------------------------------------------
% HYPOTHESIS ENVIRONMENT
% ----------------------------------------------------------------------------
% For unproven assumptions and working hypotheses that require validation.
% Styled with dash-dot border to indicate "tentative/uncertain".

\newtcolorbox[use counter=scientificclaim, number within=chapter]{hypothesis}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=hypothesisbg,
  colframe=hypothesisframe,
  boxrule=0pt,
  arc=2pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Hypothesis~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={1pt}{0pt}{hypothesisframe, dash dot},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=hypothesisbg,
    colframe=hypothesisframe,
    boxrule=0.5pt,
    arc=1pt
  }
}

% ----------------------------------------------------------------------------
% AXIOM ENVIRONMENT
% ----------------------------------------------------------------------------
% For foundational statements that are taken as given.
% Styled with thick double border for maximum prominence (foundational claims).

\newtcolorbox[use counter=scientificclaim, number within=chapter]{axiom}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=axiombg,
  colframe=axiomframe,
  boxrule=1.2pt,
  arc=0pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Axiom~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={2pt}{-4pt}{axiomframe},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=axiombg,
    colframe=axiomframe,
    boxrule=0.8pt,
    arc=0pt
  }
}

% ----------------------------------------------------------------------------
% ASSUMPTION ENVIRONMENT
% ----------------------------------------------------------------------------
% For working assumptions with similar epistemic status to hypothesis.
% Styled with left and right bars to indicate "bracketed/conditional".

\newtcolorbox[use counter=scientificclaim, number within=chapter]{assumption}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=assumptionbg,
  colframe=assumptionframe,
  boxrule=0pt,
  arc=0pt,
  left=10pt,
  right=10pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Assumption~\thescientificclaim\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline west={2pt}{0pt}{assumptionframe},
  borderline east={2pt}{0pt}{assumptionframe},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=assumptionbg,
    colframe=assumptionframe,
    boxrule=0.5pt,
    arc=0pt
  }
}

% ----------------------------------------------------------------------------
% CONCLUSION ENVIRONMENT (section-level)
% ----------------------------------------------------------------------------
% For chapter/section conclusions summarizing key points.

\theoremstyle{remark}
\newtheorem{conclusion}{Conclusion}

% ----------------------------------------------------------------------------
% DERIVATION ENVIRONMENT
% ----------------------------------------------------------------------------
% For step-by-step mathematical derivations that aren't formal theorems.

\theoremstyle{definition}
\newtheorem{derivation@inner}[scientificclaim]{Derivation}
\newenvironment{derivation}[1][]
  {\begin{derivation@inner}\ifstrempty{#1}{}{\textnormal{(#1)}}\itshape}
  {\hfill$\square$\end{derivation@inner}}

% ============================================================================
% STARRED VARIANTS (unnumbered)
% ============================================================================
% For environments that don't need numbering (e.g., in appendices)

\newtcolorbox{achievement*}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=achievementbg,
  colframe=achievementframe,
  boxrule=0.8pt,
  arc=2pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Achievement\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={1.5pt}{-3pt}{achievementframe!50},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=achievementbg,
    colframe=achievementframe,
    boxrule=0.5pt,
    arc=1pt
  }
}

\newtcolorbox{prediction*}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=predictionbg,
  colframe=predictionframe,
  boxrule=1pt,
  arc=0pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Prediction\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={0.8pt}{0pt}{predictionframe, dashed},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=predictionbg,
    colframe=predictionframe,
    boxrule=0.5pt,
    arc=0pt
  }
}

\newtcolorbox{open_question*}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=openquestionbg,
  colframe=openquestionframe,
  boxrule=0pt,
  arc=2pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Open Question\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={1pt}{0pt}{openquestionframe, dotted},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=openquestionbg,
    colframe=openquestionframe,
    boxrule=0.5pt,
    arc=1pt
  }
}

\newtcolorbox{warning*}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=warningbg,
  colframe=warningframe,
  boxrule=0pt,
  arc=0pt,
  left=10pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Warning\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline west={3pt}{0pt}{warningframe},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=warningbg,
    colframe=warningframe,
    boxrule=0.5pt,
    arc=0pt
  }
}

\newtcolorbox{hypothesis*}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=hypothesisbg,
  colframe=hypothesisframe,
  boxrule=0pt,
  arc=2pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Hypothesis\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={1pt}{0pt}{hypothesisframe, dash dot},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=hypothesisbg,
    colframe=hypothesisframe,
    boxrule=0.5pt,
    arc=1pt
  }
}

\newtcolorbox{axiom*}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=axiombg,
  colframe=axiomframe,
  boxrule=1.2pt,
  arc=0pt,
  left=8pt,
  right=8pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Axiom\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline={2pt}{-4pt}{axiomframe},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=axiombg,
    colframe=axiomframe,
    boxrule=0.8pt,
    arc=0pt
  }
}

\newtcolorbox{assumption*}[1][]{%
  enhanced,
  breakable,
  break at=-\baselineskip,
  colback=assumptionbg,
  colframe=assumptionframe,
  boxrule=0pt,
  arc=0pt,
  left=10pt,
  right=10pt,
  top=6pt,
  bottom=6pt,
  fonttitle=\bfseries\sffamily,
  title=Assumption\ifstrempty{#1}{}{: #1},
  before upper={\parindent=1.5em},
  borderline west={2pt}{0pt}{assumptionframe},
  borderline east={2pt}{0pt}{assumptionframe},
  coltitle=black,
  attach boxed title to top left={yshift=-2mm, xshift=4mm},
  boxed title style={
    colback=assumptionbg,
    colframe=assumptionframe,
    boxrule=0.5pt,
    arc=0pt
  }
}
